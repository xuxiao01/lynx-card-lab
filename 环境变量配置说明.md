# 环境变量配置说明

## ✅ 自动获取域名

现在代码已经改进为**自动获取运行环境的域名和端口**，不再需要硬编码 IP 地址！

### 工作原理

```typescript
// 自动从 window.location 获取当前访问的域名
function getHostURL(): string {
  if (typeof window !== 'undefined' && window.location) {
    const { protocol, hostname } = window.location
    return `${protocol}//${hostname}`  // 例如: http://192.168.0.100
  }
  // 降级方案：环境变量
  return import.meta.env.VITE_DEV_HOST || 'http://192.168.0.100'
}
```

### 优势

✅ **无需手动修改代码**
- 自动适配不同的开发环境
- IP 地址变化不需要改代码
- 不同开发者不需要各自修改配置

✅ **智能降级**
- 优先从 `window.location` 自动获取
- 如果获取失败，使用环境变量
- 最后使用默认值兜底

## 🔧 可选配置

如果自动获取失败，可以通过环境变量手动配置。

### 创建 `.env.local` 文件

在项目根目录创建 `.env.local` 文件：

```bash
# 开发主机地址（不包含端口）
VITE_DEV_HOST=http://192.168.0.100

# 后端 API 端口
VITE_API_PORT=4000

# 前端开发服务器端口  
VITE_DEV_PORT=3001

# 前端完整地址（可选）
VITE_DEV_URL=http://192.168.0.100:3001
```

### 如何获取本机 IP

**macOS/Linux:**
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

**Windows:**
```bash
ipconfig
```

## 📝 配置优先级

代码会按以下优先级获取配置：

1. **自动获取** - 从 `window.location` 获取当前域名
2. **环境变量** - 从 `.env.local` 读取配置
3. **默认值** - 使用内置的默认值（192.168.0.100）

## 🎯 使用示例

### API 请求

```typescript
// Lynx 环境
// 自动获取: http://192.168.0.100:4000/api/shops
// 
// 浏览器环境  
// 相对路径: /api/shops (通过代理)
```

### 静态资源

```typescript
// Lynx 环境
// 自动获取: http://192.168.0.100:3001/static/image/xxx.png
//
// 浏览器环境
// 相对路径: /static/image/xxx.png
```

## ⚠️ 注意事项

1. **`.env.local` 不会被提交到 Git**
   - 这是个人配置文件
   - 每个开发者可以有自己的配置

2. **环境变量修改后需要重启**
   - 修改 `.env.local` 后重启开发服务器
   - `Ctrl+C` 停止，然后重新 `npm run dev`

3. **大多数情况下不需要配置**
   - 自动获取功能在大部分环境都能正常工作
   - 只有在自动获取失败时才需要手动配置

## 🚀 测试自动获取

启动开发服务器后，在浏览器控制台执行：

```javascript
console.log(window.location.protocol)  // http:
console.log(window.location.hostname)  // 192.168.0.100
console.log(window.location.port)      // 3001
```

这些值会被自动用于构建 API 请求地址！

## 📚 相关文档

- **`Lynx网络请求问题总结.md`** - 完整的问题分析
- **`API使用说明.md`** - API 使用指南

