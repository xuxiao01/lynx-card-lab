## douyin_search_lynx_exercise

æŠ–éŸ³æœç´¢åŸ¹è®­è¥é¢˜ç›® - åŸºäº Lynx + TypeScript çš„é¤å…å›¢è´­é¡µé¢

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pnpm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆé¦–æ¬¡å¿…åšï¼‰âš ï¸

**Lynx çœŸæœºç¯å¢ƒå¿…é¡»é…ç½®ï¼**

```bash
# æ–¹æ³• 1ï¼šè‡ªåŠ¨é…ç½®ï¼ˆæ¨èï¼‰
./setup-env.sh

# æ–¹æ³• 2ï¼šæ‰‹åŠ¨é…ç½®
# 1. è·å–ä½ çš„ IPï¼šifconfig | grep "inet " | grep -v 127.0.0.1
# 2. ç¼–è¾‘ .env.localï¼Œæ›¿æ¢ä¸ºä½ çš„ IP
```

è¯¦è§ï¼š[ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜](./docs/getting-started/ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜.md) æˆ– [å¿«é€Ÿå¼€å§‹](./docs/getting-started/å¿«é€Ÿå¼€å§‹.md)

### 3. å¯åŠ¨æœåŠ¡

**ç»ˆç«¯ 1 - å¯åŠ¨ Mock APIï¼š**
```bash
node mock/server.cjs
```
Mock API æœåŠ¡å°†åœ¨ `http://localhost:4000` å¯åŠ¨ï¼ˆå±€åŸŸç½‘è®¿é—®ä½¿ç”¨çœŸå® IPï¼‰ã€‚

**ç»ˆç«¯ 2 - å¯åŠ¨å¼€å‘æœåŠ¡ï¼š**
```bash
pnpm run dev
```
å¼€å‘æœåŠ¡å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

### 4. è®¿é—®åº”ç”¨

- **æµè§ˆå™¨**: `http://ä½ çš„IP:3000`
- **Lynx Explorer**: `http://ä½ çš„IP:3000/main.lynx.bundle`

## ğŸ“š å®Œæ•´æ–‡æ¡£

è¯¦ç»†æ–‡æ¡£è¯·æŸ¥çœ‹ [docs ç›®å½•](./docs/)ï¼š

### ğŸš€ å…¥é—¨æŒ‡å—
- **[å¿«é€Ÿå¼€å§‹](./docs/getting-started/å¿«é€Ÿå¼€å§‹.md)** â­ æ¨èé¦–è¯»
- [é…ç½®å®Œæˆæ€»ç»“](./docs/getting-started/é…ç½®å®Œæˆæ€»ç»“.md)
- [ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜](./docs/getting-started/ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜.md)

### ğŸ“– å¼€å‘æŒ‡å—
- [API ä½¿ç”¨è¯´æ˜](./docs/guides/APIä½¿ç”¨è¯´æ˜.md)
- [æ€§èƒ½ç›‘æ§è¯´æ˜](./docs/guides/æ€§èƒ½ç›‘æ§è¯´æ˜.md)
- [Performance API è¯¦ç»†è¯´æ˜](./docs/guides/Performance-API-è¯´æ˜.md)

### ğŸ”§ é—®é¢˜æ’æŸ¥
- [Lynx çœŸæœºè°ƒè¯•è¯´æ˜](./docs/troubleshooting/LynxçœŸæœºè°ƒè¯•è¯´æ˜.md)
- [Lynx ç½‘ç»œè¯·æ±‚é—®é¢˜æ€»ç»“](./docs/troubleshooting/Lynxç½‘ç»œè¯·æ±‚é—®é¢˜æ€»ç»“.md)
- [Lynx Performance API FAQ](./docs/troubleshooting/Lynx-Performance-API-FAQ.md) â­ é‡è¦

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯æŠ–éŸ³æœç´¢ / Lynx å·¥ç¨‹å¸ˆè®­ç»ƒè¥çš„ç»ƒä¹ é¡¹ç›®ï¼ŒåŸºäº **Lynx + TypeScript + React** å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„é¤å…å›¢è´­é¡µé¢ã€‚

### å·²å®ç°åŠŸèƒ½

âœ… **é¡µé¢ç»„ä»¶**
- é¤å…ä¿¡æ¯å¤´éƒ¨å¡ç‰‡ï¼ˆ`RestaurantHeader`ï¼‰
- å›¢è´­å•†å“å¡ç‰‡ï¼ˆ`DealCard`ï¼‰
- æ¨ªå‘æ»šåŠ¨å›¢è´­åˆ—è¡¨ï¼ˆ`DealList`ï¼‰

âœ… **ç½‘ç»œè¯·æ±‚**
- HTTP è¯·æ±‚å°è£…ï¼ˆ`utils/http.ts`ï¼‰
- ç¯å¢ƒè‡ªåŠ¨æ£€æµ‹ï¼ˆLynx / æµè§ˆå™¨ï¼‰
- å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
- API æœåŠ¡å±‚ï¼ˆ`services/shop.ts`ï¼‰

âœ… **é™æ€èµ„æºå¤„ç†**
- å›¾ç‰‡ URL è‡ªåŠ¨è½¬æ¢ï¼ˆ`utils/url.ts`ï¼‰
- Lynx ç¯å¢ƒé€‚é…
- é™çº§å›¾ç‰‡æ”¯æŒ

âœ… **æ€§èƒ½ç›‘æ§**
- Lynx Performance API é›†æˆ
- `__lynx_timing_flag` æ ‡è®°
- `usePerformanceMetrics` Hook
- Actual FMP æŒ‡æ ‡ç›‘æ§

âœ… **å¼€å‘ä½“éªŒ**
- ç¯å¢ƒå˜é‡é…ç½®
- è‡ªåŠ¨é…ç½®è„šæœ¬
- Mock API æœåŠ¡
- å®Œæ•´çš„æ–‡æ¡£ä½“ç³»

### æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Lynx + React
- **è¯­è¨€**: TypeScript
- **æ„å»º**: Vite
- **API**: Express.js (Mock Server)
- **æ ·å¼**: CSS

## Mock API æ¥å£è¯´æ˜

é¡¹ç›®æä¾›äº†æœ¬åœ° Mock API æœåŠ¡ï¼Œç”¨äºæ¨¡æ‹Ÿåç«¯æ¥å£ã€‚Mock æœåŠ¡ä½äº `mock/` ç›®å½•ä¸‹ã€‚

### API æ¥å£

#### 1. è·å–æ‰€æœ‰å•†å®¶ä¿¡æ¯
- **æ¥å£**: `GET /api/shops`
- **è¯´æ˜**: è·å–æ‰€æœ‰å•†å®¶ä¿¡æ¯åˆ—è¡¨
- **å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "data": [
    {
      "restaurantId": "1",
      "restaurantName": "æ¤’é¸£æ¤’éº»é¦†(äº”é“å£åº—)",
      "restaurantCover": "/static/image/default-cover.72a863cc.png",
      "rating": 3.5,
      "ratingText": "å¯ä»¥ä¸€è¯•",
      "reviewCount": 170,
      "category": "ä¸­é¤",
      "area": "é¾™æŸåœ°åŒº",
      "avgPrice": 220,
      "distance": "842m",
      "tags": ["å¿ƒåŠ¨æ¦œ2025å¹´ä¸Šæ¦œé¤å…", "å¤šäººèšé¤", "ç”Ÿæ—¥è½°è¶´", "å¯è®¢æ¡Œ"]
    }
  ],
  "message": "success"
}
```

#### 2. è·å–å•†å®¶å›¢è´­å•†å“
- **æ¥å£**: `POST /api/deals`
- **è¯´æ˜**: é€šè¿‡å•†å®¶ ID è·å–å¯¹åº”çš„å›¢è´­å•†å“åˆ—è¡¨
- **è¯·æ±‚å‚æ•°**:
```json
{
  "restaurantId": "1"
}
```
- **å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "data": [
    {
      "dealId": "1",
      "dealImage": "/static/image/food-default.b740debc.png",
      "badges": [
        {
          "text": "ç‰¹æƒ è¡¥è´´",
          "subText": "å‡10",
          "type": "normal"
        }
      ],
      "dealTitle": "ã€ç¥ä»™ä¸‹åˆèŒ¶ã€‘æ¤’éº»é¸¡+æ¤’éº»é±¼+é…èœ+è¶…å¤§æ¯æŸ æª¬èŒ¶",
      "price": 168,
      "originalPrice": 298,
      "buttonText": "æŠ¢è´­"
    }
    // ... æ›´å¤šå•†å“
  ],
  "message": "success"
}
```

### æ•°æ®æ–‡ä»¶

Mock æ•°æ®å­˜å‚¨åœ¨ `mock/data/` ç›®å½•ä¸‹ï¼š
- `shop.json`: å•†å®¶ä¿¡æ¯æ•°æ®ï¼ˆ1 ä¸ªå•†å®¶ï¼‰
- `products.json`: å›¢è´­å•†å“æ•°æ®ï¼ˆ10 ä¸ªå•†å“ï¼‰

### ä»£ç†é…ç½®

å¼€å‘ç¯å¢ƒçš„ä»£ç†é…ç½®åœ¨ `lynx.config.ts` ä¸­ï¼š
- **æµè§ˆå™¨ç¯å¢ƒ**: `/api` è¯·æ±‚ä¼šè‡ªåŠ¨ä»£ç†åˆ° `http://localhost:4000`
- **Lynx ç¯å¢ƒ**: ä½¿ç”¨å®Œæ•´ URLï¼ˆé…ç½®åœ¨ `.env.local`ï¼‰

âš ï¸ **æ³¨æ„**ï¼šLynx çœŸæœºç¯å¢ƒä¸èƒ½ä½¿ç”¨ä»£ç†ï¼Œå¿…é¡»é…ç½®å®Œæ•´ URLï¼

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ restaurant/           # é¤å…é¡µé¢
â”‚   â”‚       â”œâ”€â”€ index.tsx         # ä¸»é¡µé¢
â”‚   â”‚       â””â”€â”€ components/       # é¡µé¢ç»„ä»¶
â”‚   â”‚           â”œâ”€â”€ RestaurantHeader.tsx  # é¤å…å¤´éƒ¨
â”‚   â”‚           â”œâ”€â”€ DealCard.tsx          # å›¢è´­å¡ç‰‡
â”‚   â”‚           â””â”€â”€  DealList.tsx         # å›¢è´­åˆ—è¡¨ï¼ˆå«æ€§èƒ½ç›‘æ§ï¼‰
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ http.ts               # HTTP è¯·æ±‚å°è£…
â”‚   â”‚   â””â”€â”€ url.ts                # URL å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ shop.ts               # å•†å®¶å’Œå›¢è´­ API
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ usePerformanceMetrics.ts  # æ€§èƒ½ç›‘æ§ Hook
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ common.ts             # é€šç”¨ç±»å‹
â”‚   â”‚   â””â”€â”€ restaurant.ts         # é¤å…/å›¢è´­ç±»å‹
â”‚   â””â”€â”€ assets/                   # é™æ€èµ„æº
â”œâ”€â”€ mock/
â”‚   â”œâ”€â”€ server.cjs                # Mock API æœåŠ¡å™¨
â”‚   â””â”€â”€ data/
â”‚       â”œâ”€â”€ shop.json             # å•†å®¶æ•°æ®
â”‚       â””â”€â”€ products.json         # å›¢è´­å•†å“æ•°æ®
â”œâ”€â”€ docs/                         # ğŸ“š å®Œæ•´æ–‡æ¡£
â”‚   â”œâ”€â”€ getting-started/          # ğŸš€ å…¥é—¨æŒ‡å—
â”‚   â”œâ”€â”€ guides/                   # ğŸ“– å¼€å‘æŒ‡å—
â”‚   â””â”€â”€ troubleshooting/          # ğŸ”§ é—®é¢˜æ’æŸ¥
â”œâ”€â”€ .env.local                    # ç¯å¢ƒé…ç½®ï¼ˆéœ€è¦æ‰‹åŠ¨é…ç½®ï¼‰
â”œâ”€â”€ env-template.txt              # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ setup-env.sh                  # è‡ªåŠ¨é…ç½®è„šæœ¬
```

## âš ï¸ é‡è¦æç¤º

### Lynx çœŸæœºç¯å¢ƒç‰¹æ®Šé™åˆ¶

1. **`window.location` ä¸å¯ç”¨**
   - æ— æ³•è‡ªåŠ¨è·å–åŸŸåå’Œç«¯å£
   - å¿…é¡»é€šè¿‡ `.env.local` é…ç½®å®Œæ•´ URL

2. **ä¸èƒ½ä½¿ç”¨ `localhost`**
   - Lynx ä¸­ `localhost` æŒ‡å‘è®¾å¤‡æœ¬èº«
   - å¿…é¡»ä½¿ç”¨çœŸå® IP åœ°å€

3. **Performance API ä»…ç”Ÿäº§å¯ç”¨**
   - å¼€å‘ç¯å¢ƒ `performance` æ˜¯ `undefined`ï¼ˆæ­£å¸¸ç°è±¡ï¼‰
   - æ€§èƒ½æ•°æ®åªåœ¨çœŸå® Lynx å®¹å™¨ï¼ˆå¦‚æŠ–éŸ³ Appï¼‰ä¸­æ”¶é›†

è¯¦è§ï¼š[Lynx ç½‘ç»œè¯·æ±‚é—®é¢˜æ€»ç»“](./docs/troubleshooting/Lynxç½‘ç»œè¯·æ±‚é—®é¢˜æ€»ç»“.md)

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: API è¯·æ±‚å¤±è´¥ï¼ŒæŠ¥ HTTP 499 é”™è¯¯ï¼Ÿ

**A**: è¯·æ£€æŸ¥ `.env.local` é…ç½®ï¼š
1. IP åœ°å€æ˜¯å¦æ­£ç¡®ï¼ˆä¸èƒ½æ˜¯ `localhost`ï¼‰
2. ç«¯å£æ˜¯å¦æ­£ç¡®ï¼ˆåç«¯ 4000ï¼Œå‰ç«¯ 3000ï¼‰
3. æ˜¯å¦é‡å¯äº†å¼€å‘æœåŠ¡å™¨

è¯¦è§ï¼š[Lynx çœŸæœºè°ƒè¯•è¯´æ˜](./docs/troubleshooting/LynxçœŸæœºè°ƒè¯•è¯´æ˜.md)

### Q: å›¾ç‰‡ä¸æ˜¾ç¤ºï¼Ÿ

**A**: æ£€æŸ¥ `VITE_FRONTEND_URL` é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œå‰ç«¯æœåŠ¡å™¨æ˜¯å¦è¿è¡Œã€‚

### Q: Performance API æ˜¯ undefinedï¼Ÿ

**A**: è¿™æ˜¯æ­£å¸¸çš„ï¼å¼€å‘ç¯å¢ƒä¸æ”¯æŒ Performance APIï¼Œåªåœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆæŠ–éŸ³ Appï¼‰ä¸­å¯ç”¨ã€‚

è¯¦è§ï¼š[Lynx Performance API FAQ](./docs/troubleshooting/Lynx-Performance-API-FAQ.md)

### Q: ä¿®æ”¹äº† `.env.local` ä¸ç”Ÿæ•ˆï¼Ÿ

**A**: éœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨ï¼ˆCtrl+C ç„¶å `npm run dev`ï¼‰ã€‚

## ğŸ¯ å¼€å‘æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹å¼€å‘å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] å·²å®‰è£…ä¾èµ–ï¼ˆ`pnpm install`ï¼‰
- [ ] å·²é…ç½® `.env.local`ï¼ˆè¿è¡Œ `./setup-env.sh` æˆ–æ‰‹åŠ¨é…ç½®ï¼‰
- [ ] IP åœ°å€æ˜¯çœŸå® IPï¼Œä¸æ˜¯ `localhost`
- [ ] åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆç«¯å£ 4000ï¼‰
- [ ] å‰ç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆç«¯å£ 3000ï¼‰
- [ ] æµè§ˆå™¨æµ‹è¯•é€šè¿‡
- [ ] Lynx Explorer æµ‹è¯•é€šè¿‡ï¼ˆå¯é€‰ï¼‰

## ğŸ“¦ æ„å»ºå’Œéƒ¨ç½²

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# æ£€æŸ¥æ„å»ºäº§ç‰©
ls -lh dist/main.lynx.bundle

# éƒ¨ç½²åˆ° CDNï¼ˆæ ¹æ®å®é™…æƒ…å†µï¼‰
# åœ¨ Lynx å®¹å™¨ä¸­è®¿é—®ï¼šhttp://your-cdn.com/main.lynx.bundle
```

## ğŸ”— ç›¸å…³èµ„æº

- [Lynx å®˜æ–¹æ–‡æ¡£](https://lynxjs.org/zh/)
- [Lynx Performance API](https://lynxjs.org/zh/api/lynx-api/performance-api/)
- [é¡¹ç›®å®Œæ•´æ–‡æ¡£](./docs/)

---

**Happy Coding!** ğŸ‰