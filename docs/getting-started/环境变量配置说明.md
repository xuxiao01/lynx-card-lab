# çŽ¯å¢ƒå˜é‡é…ç½®è¯´æ˜Ž

## ðŸš¨ é‡è¦è¯´æ˜Ž

ç”±äºŽ **Lynx çœŸæœºçŽ¯å¢ƒä¸­ `window.location` ä¸å¯ç”¨**ï¼Œé¡¹ç›®å·²æ”¹ä¸ºå®Œå…¨ä¾èµ–çŽ¯å¢ƒå˜é‡é…ç½®ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦çŽ¯å¢ƒå˜é‡ï¼Ÿ

åœ¨ Lynx çœŸæœºçŽ¯å¢ƒä¸­ï¼š
- âŒ `window` æ˜¯ `undefined`
- âŒ `window.location` ä¸å¯ç”¨
- âŒ æ— æ³•è‡ªåŠ¨èŽ·å–å½“å‰åŸŸåå’Œç«¯å£
- âœ… **å¿…é¡»**é€šè¿‡çŽ¯å¢ƒå˜é‡é…ç½®å®Œæ•´ URL

## ðŸ”§ å¿«é€Ÿå¼€å§‹

### 1. å¤åˆ¶é…ç½®æ–‡ä»¶

```bash
cp .env.example .env.local
```

### 2. èŽ·å–æœ¬æœº IP

**macOS/Linux:**
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

**Windows:**
```bash
ipconfig
```

**æˆ–è€…å¯åŠ¨åŽç«¯æŸ¥çœ‹ï¼š**
```bash
node mock/server.cjs
# ä¼šæ˜¾ç¤º: å±€åŸŸç½‘è®¿é—®: http://192.168.0.100:4000
```

### 3. ç¼–è¾‘ `.env.local`

```bash
# åŽç«¯ API åœ°å€ï¼ˆå®Œæ•´ URLï¼ŒåŒ…å«ç«¯å£ï¼‰
VITE_API_HOST=http://ä½ çš„IP:4000

# å‰ç«¯æœåŠ¡å™¨åœ°å€ï¼ˆå®Œæ•´ URLï¼ŒåŒ…å«ç«¯å£ï¼‰
VITE_FRONTEND_URL=http://ä½ çš„IP:3000
```

ä¾‹å¦‚ï¼š
```bash
VITE_API_HOST=http://192.168.0.100:4000
VITE_FRONTEND_URL=http://192.168.0.100:3000
```

### 4. é‡å¯å¼€å‘æœåŠ¡å™¨

```bash
# åœæ­¢æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰
# é‡æ–°å¯åŠ¨
npm run dev
```

## ðŸ“‹ çŽ¯å¢ƒå˜é‡è¯´æ˜Ž

### `VITE_API_HOST`

- **ä½œç”¨**ï¼šåŽç«¯ API çš„å®Œæ•´åœ°å€
- **æ ¼å¼**ï¼š`http://IP:ç«¯å£`
- **ç¤ºä¾‹**ï¼š`http://192.168.0.100:4000`
- **å¿…é¡»åŒ…å«**ï¼š
  - âœ… åè®®ï¼š`http://`
  - âœ… IP åœ°å€ï¼šçœŸå®ž IPï¼ˆä¸èƒ½æ˜¯ `localhost`ï¼‰
  - âœ… ç«¯å£ï¼šåŽç«¯ç«¯å£ï¼ˆé€šå¸¸æ˜¯ `4000`ï¼‰

### `VITE_FRONTEND_URL`

- **ä½œç”¨**ï¼šå‰ç«¯æœåŠ¡å™¨åœ°å€ï¼Œç”¨äºŽè®¿é—®é™æ€èµ„æºï¼ˆå›¾ç‰‡ç­‰ï¼‰
- **æ ¼å¼**ï¼š`http://IP:ç«¯å£`
- **ç¤ºä¾‹**ï¼š`http://192.168.0.100:3000`
- **å¿…é¡»åŒ…å«**ï¼š
  - âœ… åè®®ï¼š`http://`
  - âœ… IP åœ°å€ï¼šçœŸå®ž IP
  - âœ… ç«¯å£ï¼šå‰ç«¯ç«¯å£ï¼ˆé€šå¸¸æ˜¯ `3000`ï¼‰

## ðŸŽ¯ å·¥ä½œåŽŸç†

### API è¯·æ±‚ï¼ˆ`http.ts`ï¼‰

```typescript
function getBaseURL(): string {
  const isLynx = typeof __MAIN_THREAD__ !== 'undefined'
  
  if (isLynx) {
    // Lynx çŽ¯å¢ƒï¼šä½¿ç”¨çŽ¯å¢ƒå˜é‡é…ç½®çš„å®Œæ•´ URL
    return import.meta.env.VITE_API_HOST || 'http://192.168.0.100:4000'
  } else {
    // æµè§ˆå™¨ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé€šè¿‡ä»£ç†
    return ''
  }
}
```

**å®žé™…æ•ˆæžœ**ï¼š

| çŽ¯å¢ƒ | è¯·æ±‚ URL | è¯´æ˜Ž |
|------|----------|------|
| Lynx | `http://192.168.0.100:4000/api/shops` | ä½¿ç”¨ `VITE_API_HOST` |
| æµè§ˆå™¨ | `/api/shops` | ç›¸å¯¹è·¯å¾„ï¼Œé€šè¿‡ä»£ç† |

### é™æ€èµ„æºï¼ˆ`url.ts`ï¼‰

```typescript
function getFrontendURL(): string {
  // ç›´æŽ¥ä½¿ç”¨çŽ¯å¢ƒå˜é‡é…ç½®
  return import.meta.env.VITE_FRONTEND_URL || 'http://192.168.0.100:3000'
}
```

**å®žé™…æ•ˆæžœ**ï¼š

| çŽ¯å¢ƒ | å›¾ç‰‡ URL | è¯´æ˜Ž |
|------|----------|------|
| Lynx | `http://192.168.0.100:3000/static/image/xxx.png` | ä½¿ç”¨ `VITE_FRONTEND_URL` |
| æµè§ˆå™¨ | `/static/image/xxx.png` | ç›¸å¯¹è·¯å¾„ |

## ðŸ“ é…ç½®ä¼˜å…ˆçº§

```
1. çŽ¯å¢ƒå˜é‡ï¼ˆ.env.localï¼‰     â† ä¼˜å…ˆçº§æœ€é«˜
2. é»˜è®¤å€¼ï¼ˆ192.168.0.100ï¼‰    â† å…œåº•æ–¹æ¡ˆ
```

## âš ï¸ å¸¸è§é—®é¢˜

### 1. ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ `localhost`ï¼Ÿ

åœ¨ Lynx çœŸæœºä¸­ï¼Œ`localhost` æŒ‡å‘**è®¾å¤‡æœ¬èº«**ï¼Œä¸æ˜¯ä½ çš„å¼€å‘ç”µè„‘ã€‚

```
âŒ é”™è¯¯ï¼šhttp://localhost:4000
âœ… æ­£ç¡®ï¼šhttp://192.168.0.100:4000
```

### 2. ç«¯å£å·æ˜¯å¤šå°‘ï¼Ÿ

æ£€æŸ¥ä½ çš„å¯åŠ¨æ—¥å¿—ï¼š

```bash
# åŽç«¯ï¼ˆmock serverï¼‰
$ node mock/server.cjs
Mock API è¿è¡Œåœ¨ http://localhost:4000
å±€åŸŸç½‘è®¿é—®: http://192.168.0.100:4000   â† ä½¿ç”¨è¿™ä¸ª

# å‰ç«¯ï¼ˆdev serverï¼‰
$ npm run dev
  âžœ  Local:   http://localhost:3000/
  âžœ  Network: http://192.168.0.100:3000/ â† ä½¿ç”¨è¿™ä¸ª
```

### 3. ä¿®æ”¹äº† `.env.local` ä½†ä¸ç”Ÿæ•ˆï¼Ÿ

**å¿…é¡»é‡å¯å¼€å‘æœåŠ¡å™¨**ï¼š

```bash
# 1. åœæ­¢ï¼ˆCtrl+Cï¼‰
# 2. é‡æ–°å¯åŠ¨
npm run dev
```

### 4. IP åœ°å€ç»å¸¸å˜åŒ–æ€Žä¹ˆåŠžï¼Ÿ

**æ–¹æ³• 1ï¼šä½¿ç”¨è‡ªåŠ¨é…ç½®è„šæœ¬**
```bash
./setup-env.sh
# ä¼šè‡ªåŠ¨æ£€æµ‹ IP å¹¶ç”Ÿæˆ .env.local
```

**æ–¹æ³• 2ï¼šç»‘å®šå›ºå®š IP**
- åœ¨è·¯ç”±å™¨ä¸­ä¸ºä½ çš„ç”µè„‘åˆ†é…é™æ€ IP
- æˆ–è€…ä½¿ç”¨å…¬å¸å†…ç½‘çš„å›ºå®š IP

### 5. `.env.local` æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ

åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸Ž `package.json` åŒçº§ï¼‰ï¼š

```
byteDance_test/douyin_search_lynx_exercise/
â”œâ”€â”€ .env.local          â† åˆ›å»ºè¿™ä¸ªæ–‡ä»¶
â”œâ”€â”€ .env.example        â† ç¤ºä¾‹æ–‡ä»¶ï¼ˆå¯å¤åˆ¶ï¼‰
â”œâ”€â”€ package.json
â”œâ”€â”€ lynx.config.ts
â””â”€â”€ ...
```

## ðŸš€ éªŒè¯é…ç½®

### 1. å¯åŠ¨æœåŠ¡

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨åŽç«¯
node mock/server.cjs

# ç»ˆç«¯ 2ï¼šå¯åŠ¨å‰ç«¯
npm run dev
```

### 2. æ£€æŸ¥æ—¥å¿—

åœ¨ Lynx æŽ§åˆ¶å°åº”è¯¥çœ‹åˆ°ï¼š

```
[HTTP] Lynx çŽ¯å¢ƒæ£€æµ‹:
  - API Host: http://192.168.0.100:4000  â† åº”è¯¥æ˜¯ä½ çš„ IP
  - çŽ¯å¢ƒ: å¼€å‘

[URL] å‰ç«¯æœåŠ¡å™¨åœ°å€: http://192.168.0.100:3000  â† åº”è¯¥æ˜¯ä½ çš„ IP
```

### 3. æµ‹è¯• API

```bash
# æµ‹è¯•åŽç«¯
curl http://ä½ çš„IP:4000/api/shops

# åº”è¯¥è¿”å›žé¤åŽ…æ•°æ®
```

## ðŸ“š æ–‡ä»¶è¯´æ˜Ž

| æ–‡ä»¶ | ä½œç”¨ | æ˜¯å¦æäº¤åˆ° Git |
|------|------|----------------|
| `.env.local` | ä¸ªäººé…ç½® | âŒ ä¸æäº¤ |
| `.env.example` | é…ç½®ç¤ºä¾‹ | âœ… æäº¤ |
| `.env.production` | ç”Ÿäº§çŽ¯å¢ƒé…ç½® | âŒ ä¸æäº¤ |

## ðŸŽ¯ å®Œæ•´æµç¨‹ç¤ºä¾‹

```bash
# 1. èŽ·å– IP
$ ifconfig | grep "inet " | grep -v 127.0.0.1
inet 192.168.0.100 netmask 0xffffff00 broadcast 192.168.0.255

# 2. åˆ›å»ºé…ç½®æ–‡ä»¶
$ cat > .env.local << 'EOF'
VITE_API_HOST=http://192.168.0.100:4000
VITE_FRONTEND_URL=http://192.168.0.100:3000
EOF

# 3. å¯åŠ¨æœåŠ¡
$ node mock/server.cjs &  # åŽå°è¿è¡Œ
$ npm run dev

# 4. åœ¨ Lynx Explorer ä¸­è®¿é—®
# è¾“å…¥ï¼šhttp://192.168.0.100:3000/main.lynx.bundle
```

## ðŸ“š ç›¸å…³æ–‡æ¡£

- **`LynxçœŸæœºè°ƒè¯•è¯´æ˜Ž.md`** - å®Œæ•´çš„çœŸæœºè°ƒè¯•æµç¨‹
- **`Lynxç½‘ç»œè¯·æ±‚é—®é¢˜æ€»ç»“.md`** - ç½‘ç»œè¯·æ±‚é—®é¢˜åˆ†æž
- **`APIä½¿ç”¨è¯´æ˜Ž.md`** - API ä½¿ç”¨æŒ‡å—
- **`setup-env.sh`** - è‡ªåŠ¨é…ç½®è„šæœ¬

