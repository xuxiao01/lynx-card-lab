# ğŸ“¡ API è°ƒç”¨è¯´æ˜

## ğŸ¯ ä¸ºä»€ä¹ˆè¿™æ ·å°è£…ï¼Ÿ

### é—®é¢˜
Lynx æ¡†æ¶å¯¹ç½‘ç»œè¯·æ±‚æœ‰ä¸¥æ ¼é™åˆ¶ï¼š

1. **ä¸æ”¯æŒç›¸å¯¹è·¯å¾„**
   ```
   âŒ fetch('/api/xxx') â†’ HTTP 499: unsupported URL
   ```

2. **ä¸èƒ½ä½¿ç”¨ localhost**
   ```
   âŒ fetch('http://localhost:4000/api/xxx') â†’ Could not connect
   ```

3. **å¿…é¡»ä½¿ç”¨å®Œæ•´ URL + çœŸå® IP**
   ```
   âœ… fetch('http://192.168.0.100:4000/api/xxx') â†’ æˆåŠŸ
   ```

**æ ¸å¿ƒåŸå› **ï¼šLynx æ˜¯ç§»åŠ¨ç«¯æ¸²æŸ“æ¡†æ¶ï¼Œè¿è¡Œåœ¨ç‹¬ç«‹çš„å®¢æˆ·ç«¯è®¾å¤‡ä¸Šï¼Œ`localhost` æŒ‡å‘è®¾å¤‡è‡ªå·±ï¼Œæ— æ³•è®¿é—®å¼€å‘æœºå™¨çš„æœåŠ¡å™¨ã€‚

### è§£å†³æ–¹æ¡ˆ
æˆ‘ä»¬å°è£…äº† `http.ts`ï¼Œå®ƒä¼šï¼š

1. **æ™ºèƒ½åˆ¤æ–­ç¯å¢ƒ**
   - åœ¨ **Lynx ç¯å¢ƒ**ï¼šè‡ªåŠ¨ä½¿ç”¨å®Œæ•´ URL + çœŸå® IP (`http://192.168.0.100:4000/api/xxx`)
   - åœ¨ **æµè§ˆå™¨ç¯å¢ƒ**ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„ (`/api/xxx`)ï¼Œé€šè¿‡ä»£ç†è®¿é—®

2. **ç»Ÿä¸€é”™è¯¯å¤„ç†**
   - è‡ªåŠ¨æ£€æŸ¥ HTTP çŠ¶æ€ç 
   - è‡ªåŠ¨æ£€æŸ¥ä¸šåŠ¡çŠ¶æ€ç 
   - ç»Ÿä¸€çš„é”™è¯¯æç¤º

3. **ç±»å‹å®‰å…¨**
   - å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
   - è‡ªåŠ¨æ¨å¯¼è¿”å›å€¼ç±»å‹

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ http.ts         # HTTP è¯·æ±‚å°è£…
â”œâ”€â”€ services/
â”‚   â””â”€â”€ shop.ts         # å•†å®¶ç›¸å…³ API
â””â”€â”€ types/
    â”œâ”€â”€ common.ts       # é€šç”¨ç±»å‹
    â””â”€â”€ restaurant.ts   # é¤å…/å›¢è´­ç±»å‹
```

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. åŸºç¡€ç”¨æ³•

```typescript
import { getShops, getDeals } from '@/services/shop'

// è·å–å•†å®¶åˆ—è¡¨
const shops = await getShops()
console.log(shops) // RestaurantInfo[]

// è·å–å›¢è´­å•†å“
const deals = await getDeals('1')
console.log(deals) // DealItem[]
```

### 2. åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨

```typescript
import { useEffect, useState } from 'react'
import { getShops } from '../../services/shop'
import type { RestaurantInfo } from '../../types/restaurant'

export function RestaurantPage() {
  const [restaurant, setRestaurant] = useState<RestaurantInfo | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)

  useEffect(() => {
    async function fetchData() {
      try {
        setLoading(true)
        const shops = await getShops()
        setRestaurant(shops[0])
      } catch (err) {
        setError(err instanceof Error ? err.message : 'è·å–æ•°æ®å¤±è´¥')
      } finally {
        setLoading(false)
      }
    }

    fetchData()
  }, [])

  if (loading) {
    return <view><text>åŠ è½½ä¸­...</text></view>
  }

  if (error) {
    return <view><text>é”™è¯¯: {error}</text></view>
  }

  return (
    <view>
      <text>{restaurant?.restaurantName}</text>
    </view>
  )
}
```

### 3. ç›´æ¥ä½¿ç”¨ http å·¥å…·ï¼ˆè‡ªå®šä¹‰ APIï¼‰

```typescript
import { get, post } from '@/utils/http'

// GET è¯·æ±‚
const response = await get<User[]>('/api/users', { page: 1, size: 10 })
console.log(response.data)

// POST è¯·æ±‚
const result = await post<Order>('/api/orders', { 
  productId: '123',
  quantity: 2 
})
console.log(result.data)
```

## ğŸ” å·¥ä½œåŸç†

### ç¯å¢ƒæ£€æµ‹ä¸è‡ªåŠ¨é…ç½®

`http.ts` ä¸­çš„å…³é”®ä»£ç ï¼š

```typescript
// è‡ªåŠ¨è·å–å½“å‰è®¿é—®çš„åŸŸå
function getHostURL(): string {
  if (typeof window !== 'undefined' && window.location) {
    const { protocol, hostname } = window.location
    return `${protocol}//${hostname}`  // è‡ªåŠ¨è·å–ï¼Œå¦‚: http://192.168.0.100
  }
  return import.meta.env.VITE_DEV_HOST || 'http://192.168.0.100'
}

function getBaseURL(): string {
  if (import.meta.env.DEV) {
    const isLynx = typeof __MAIN_THREAD__ !== 'undefined'
    
    if (isLynx) {
      // âœ… Lynx: è‡ªåŠ¨è·å–åŸŸå + åç«¯ç«¯å£
      const host = getHostURL()
      const backendPort = import.meta.env.VITE_API_PORT || '4000'
      return `${host}:${backendPort}`  // å¦‚: http://192.168.0.100:4000
    } else {
      // âœ… æµè§ˆå™¨: ç›¸å¯¹è·¯å¾„ + ä»£ç†
      return ''
    }
  }
  
  return import.meta.env.VITE_API_BASE_URL || ''
}
```

**å…³é”®ç‚¹**ï¼š
- âœ… **è‡ªåŠ¨è·å–åŸŸå**ï¼šä» `window.location` è‡ªåŠ¨è·å–å½“å‰è®¿é—®çš„åœ°å€
- âœ… **æ— éœ€ç¡¬ç¼–ç **ï¼šIP å˜åŒ–ä¸éœ€è¦ä¿®æ”¹ä»£ç 
- âœ… **æ™ºèƒ½é™çº§**ï¼šè‡ªåŠ¨è·å–å¤±è´¥æ—¶ä½¿ç”¨ç¯å¢ƒå˜é‡
- ä½¿ç”¨ `typeof __MAIN_THREAD__` åˆ¤æ–­æ˜¯å¦åœ¨ Lynx ç¯å¢ƒ
- Lynx ä¸­å¿…é¡»ä½¿ç”¨çœŸå® IPï¼Œä¸èƒ½ç”¨ localhost
- æµè§ˆå™¨ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé€šè¿‡ä»£ç†è½¬å‘

### è¯·æ±‚æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»„ä»¶: getShops()                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  services/shop.ts                           â”‚
â”‚  get<RestaurantInfo[]>('/api/shops')        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  utils/http.ts                              â”‚
â”‚  ç¯å¢ƒæ£€æµ‹ + æ„å»ºå®Œæ•´ URL                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                     â”‚
      â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lynx ç¯å¢ƒ   â”‚       â”‚ æµè§ˆå™¨ç¯å¢ƒ  â”‚
â”‚ å®Œæ•´ URL    â”‚       â”‚ ç›¸å¯¹è·¯å¾„    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚
      â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›´æ¥è®¿é—®    â”‚       â”‚ é€šè¿‡ä»£ç†    â”‚
â”‚ åç«¯æœåŠ¡å™¨  â”‚       â”‚ è®¿é—®åç«¯    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… ä¼˜åŠ¿

### ç›¸æ¯”ç›´æ¥ä½¿ç”¨ fetch

âŒ **ç›´æ¥ä½¿ç”¨ fetch**:
```typescript
// åœ¨ Lynx ä¸­ä¼šæŠ¥é”™
const res = await fetch('/api/shops')
const data = await res.json()

// æ¯æ¬¡éƒ½è¦å¤„ç†é”™è¯¯
if (!res.ok) {
  throw new Error('...')
}
if (data.code !== 200) {
  throw new Error('...')
}
```

âœ… **ä½¿ç”¨å°è£…çš„ http**:
```typescript
// è‡ªåŠ¨é€‚é…ç¯å¢ƒï¼Œç»Ÿä¸€é”™è¯¯å¤„ç†
const shops = await getShops()
// ç›´æ¥ä½¿ç”¨æ•°æ®ï¼Œç±»å‹å®‰å…¨
```

### ç›¸æ¯” axios

âœ… **ä¸éœ€è¦é¢å¤–ä¾èµ–**
- é¡¹ç›®ä¸­æ²¡æœ‰å®‰è£… axios
- fetch æ˜¯åŸç”Ÿ APIï¼Œæ›´è½»é‡
- å¯¹ Lynx ç¯å¢ƒæ›´å‹å¥½

âœ… **æ›´ç®€å•**
- ä¸éœ€è¦åˆ›å»ºå®ä¾‹
- ä¸éœ€è¦é…ç½®æ‹¦æˆªå™¨
- ä»£ç æ›´å°‘ï¼Œç»´æŠ¤æ›´ç®€å•

## ğŸŒ ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ

âœ… **è‡ªåŠ¨é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ï¼**

- **Lynx ç¯å¢ƒ**: è‡ªåŠ¨è·å–å½“å‰åŸŸå + åç«¯ç«¯å£ï¼ˆå¦‚ `http://192.168.0.100:4000`ï¼‰
- **æµè§ˆå™¨ç¯å¢ƒ**: ç›¸å¯¹è·¯å¾„ + ä»£ç†

**ä¼˜åŠ¿**ï¼š
- è‡ªåŠ¨é€‚é…ä¸åŒçš„å¼€å‘ç¯å¢ƒ
- IP å˜åŒ–ä¸éœ€è¦ä¿®æ”¹ä»£ç 
- ä¸åŒå¼€å‘è€…æ— éœ€å„è‡ªé…ç½®

**å¯é€‰é…ç½®**ï¼ˆå¦‚æœè‡ªåŠ¨è·å–å¤±è´¥ï¼‰ï¼š

åˆ›å»º `.env.local` æ–‡ä»¶ï¼š
```bash
VITE_DEV_HOST=http://192.168.0.100
VITE_API_PORT=4000
```

è¯¦è§ï¼š`ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜.md`

### ç”Ÿäº§ç¯å¢ƒ

å¦‚æœéœ€è¦é…ç½®ç”Ÿäº§ç¯å¢ƒçš„ API åœ°å€ï¼Œåˆ›å»º `.env.production`:

```bash
VITE_API_BASE_URL=https://api.example.com
```

ç„¶åä»£ç ä¸­çš„ `/api/shops` ä¼šè‡ªåŠ¨å˜æˆ `https://api.example.com/api/shops`

## ğŸ¯ æ€»ç»“

### Lynx ç½‘ç»œè¯·æ±‚çš„å…³é”®ç‚¹

1. **ä¸èƒ½ç”¨ç›¸å¯¹è·¯å¾„**ï¼šå¿…é¡»æ˜¯å®Œæ•´ URL
2. **ä¸èƒ½ç”¨ localhost**ï¼šå¿…é¡»ç”¨çœŸå® IP
3. **ä»£ç†ä¸èµ·ä½œç”¨**ï¼šLynx è¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼Œä¸ç»è¿‡å¼€å‘æœåŠ¡å™¨

è¯¦ç»†åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼Œè¯·æŸ¥çœ‹ `Lynxç½‘ç»œè¯·æ±‚é—®é¢˜æ€»ç»“.md`

### ä¸ºä»€ä¹ˆè¦å°è£… http.tsï¼Ÿ

âœ… **åº”è¯¥å°è£… http.ts**ï¼ˆå·²å®ç°ï¼‰
- è‡ªåŠ¨æ£€æµ‹ Lynx/æµè§ˆå™¨ç¯å¢ƒ
- è‡ªåŠ¨ä½¿ç”¨æ­£ç¡®çš„ URL æ ¼å¼
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- ç±»å‹å®‰å…¨
- ä¸éœ€è¦é¢å¤–ä¾èµ–

âŒ **ä¸éœ€è¦ axios**
- é¡¹ç›®ä¸­æ²¡æœ‰å®‰è£…
- fetch è¶³å¤Ÿè½»é‡
- å°è£…å·²è§£å†³æ‰€æœ‰é—®é¢˜

### ç°åœ¨ä½ å¯ä»¥

1. âœ… ä½¿ç”¨ `getShops()` è·å–å•†å®¶æ•°æ®
2. âœ… ä½¿ç”¨ `getDeals()` è·å–å›¢è´­æ•°æ®
3. âœ… ä½¿ç”¨ `http.get/post` è°ƒç”¨å…¶ä»– API
4. âœ… ä»£ç è‡ªåŠ¨é€‚é… Lynx å’Œæµè§ˆå™¨ç¯å¢ƒ
5. âœ… å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
6. âœ… é™æ€èµ„æºè·¯å¾„è‡ªåŠ¨å¤„ç†

**ç¯å¢ƒæ£€æµ‹ + æ™ºèƒ½é€‚é… = å®Œç¾çš„è·¨ç«¯è§£å†³æ–¹æ¡ˆï¼** ğŸ‰

### ç›¸å…³æ–‡æ¡£

- **`Lynxç½‘ç»œè¯·æ±‚é—®é¢˜æ€»ç»“.md`** - å®Œæ•´çš„é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆ
- **`ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜.md`** - è‡ªåŠ¨è·å–åŸŸåçš„åŸç†å’Œå¯é€‰é…ç½®
- **`APIä½¿ç”¨è¯´æ˜.md`** (æœ¬æ–‡æ¡£) - API ä½¿ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µ

